<% content_for :table_filter_title do %>
  <%= Spree.t(:date_range) %>
<% end %>

<% content_for :table_filter do %>
  <div id="advanced_report_search">
    <%= form_for :search do |form| %>
      <% if @stores %>
        <div class="row">
          <div class="col-sm-12">
            <%= label_tag :advanced_reporting_store_id, Spree.t(:store) %>
            <%= collection_select :search, :store_id, @stores, :id, :name, {
              include_blank: Spree.t(:all) } %>
          </div>
        </div>
      <% end %>

      <div id="taxon_products" class="row">
        <div class="col-sm-6">
          <%= label_tag :advanced_reporting_taxon_id, Spree.t(:taxon) %>
          <%= collection_select :advanced_reporting, :taxon_id, @taxons, :id, :name,
            { include_blank: Spree.t(:all) }, { class: 'select2' } %>
        </div>
        <div class="col-sm-6">
          <%= label_tag :advanced_reporting_product_id, Spree.t(:product) %>
          <%= collection_select :advanced_reporting, :product_id, @products, :id, :name,
            { include_blank: Spree.t(:all) }, { class: 'select2' } %>
        </div>
      </div>

      <div class="date-range-filter row">
        <div class="col-sm-6">
          <%= label_tag nil, Spree.t(:start) %>
          <div class="input-group">
            <%= form.text_field :created_at_gt, class: 'datepicker datepicker-from form-control' %>
            <span class="input-group-addon">
              <i class="icon icon-calendar"></i>
            </span>
          </div>
        </div>

        <div class="col-sm-6">
          <%= label_tag nil, Spree.t(:stop) %>
          <div class="input-group">
            <%= form.text_field :created_at_lt, class: 'datepicker datepicker-to form-control' %>
            <span class="input-group-addon">
              <i class="icon icon-calendar"></i>
            </span>
          </div>
        </div>
      </div>

      <div class="form-actions text-right">
        <%= button Spree.t(:filter_results), 'search' %>
      </div>
    <% end %>
  </div>
<% end %>

<% content_for :head do %>
  <script type="text/javascript">
    var completed_at_lt = "<%= (@report.unfiltered_params && @report.unfiltered_params[:completed_at_lt]) ? @report.unfiltered_params[:completed_at_lt] : '' %>";
    var completed_at_gt = "<%= (@report.unfiltered_params && @report.unfiltered_params[:completed_at_gt]) ? @report.unfiltered_params[:completed_at_gt] : '' %>";
    $(function() {
      $('#advanced_report_search form').attr('method', 'get');
    });
  </script>
<% end %>

<% if params[:advanced_reporting] %>
  <% if params[:advanced_reporting][:product_id] && params[:advanced_reporting][:product_id] != '' %>
  <input type="hidden" id="product_id" value="<%= params[:advanced_reporting][:product_id] %>" />
  <% end %>
  <% if params[:advanced_reporting][:taxon_id] && params[:advanced_reporting][:taxon_id] != '' %>
  <input type="hidden" id="taxon_id" value="<%= params[:advanced_reporting][:taxon_id] %>" />
  <% end %>
<% end %>
